# Git ガイドライン

チームで効率よく安全に開発を行うことを目的に、以下のガイドラインに則った Git 運用を行ってください。

::: info 事前に GitHub のチームに参加が必要
事前に、Shibajuku の GitHub チームに参加しておく必要があります。参加していない方は、Shibajuku Home のプロフィール設定から参加してください。
:::

## 基本ルール

- `main` ブランチへの `push` は禁止
- 操作に失敗してしまったメンバーがいても、温かく助ける

::: info あくまで学習のため
Git の操作に慣れてない方は、コンクリフトなどが怖いと感じるかもしれませんが、Shibajuku の課題やプロジェクトで慣れておくと、実際のお仕事で役立つと思いますので、積極的に利用してください。

何かあったら、チーム内で「Git ドンマイ」スタンプを送り合って温かく助け合いましょう。
:::

## リモートリポジトリ

リモートリポジトリは、 [GitHub](https://github.com/) の、[Shibajuku](https://github.com/shibajuku) 内に [@hilosiva](https://github.com/hilosiva) が作成します。

基本的には `private` リポジトリで運用しますが、以下のプロジェクトは `public` で運用いたします。

- ポートフォリオとして見せたい場合
- Shibajuku 外の方にもコードを共有したいプロジェクトの場合
- GitHub Pages で公開する場合

## ブランチ

以下のブランチで運用を行います。

| ブランチ   | 役割       | 進行                                 |
| ---------- | ---------- | ------------------------------------ |
| `main`     | 本番環境用 | `preview`ブランチからのマージで進行  |
| `preview`  | 動作確認用 | `develop` ブランチからのマージで進行 |
| `develop`  | 開発用     | `タスク名`ブランチからのマージで進行 |
| `タスク名` | 作業用     | コーディングメンバーのコミットで進行 |

## 運用ルール

### 準備

### 担当者の振り分け

コーディングメンバーが複数人いる場合は、リーダーを選定し、リーダー主導のもと各メンバーの作業範囲を明確にしてください。

一人当たりの作業範囲は、プロジェクトの規模やコーディングメンバーの人数によっても変わりますが、コンクリフトが起きにくいようにチームで相談して決定してください。

可能な限り作業するファイル単位になるように、以下の分け方を推奨します。

- HTML での開発： ページ単位で作業内容を振り分ける
- Astro での開発: コンポーネント単位で振り分ける

### タスクへの落とし込み

リモートリポジトリの「Project」からプロジェクト名を選択し、「タスク」 → 「未着手」に、タスクを登録してください。

タスクは、以下を参考に、できるだけ小さな完結可能な 1 連の作業にしてください。
また、各タスクには担当者や見積工数、作業開始日なども設定してください。

- ページ単位の場合
  - TOP ページのマークアップ
  - `header` のスタイリング
  - ドロワーメニューの実装
- コンポーネント単位の場合
  - `header` コンポーネントの実装
  - `button` コンポーネントの実装
  - スライダーのコンポーネントの実装

### コーディング開始時

#### コーディングリーダー

以下の手順を行なってください。

1. 開発環境のディレクトリで、`git init` コマンドを使ってローカルリポジトリを作成

   ::: tip 初期ブランチ
   初期ブランチが、`master` になっている場合は、`git branch -M main` で、`main` に変更してください。
   :::

2. `main` ブランチから `develop` ブランチを作成し、リモートの `develop` ブランチに初期状態を `push`

上記作業が完了したら、コーディングチームのメンバーに完了報告をしてください。

### コーディング担当者

コーディングリーダーからの作業完了報告を受けた後、リモートリポジトリを `clone` してください。

### 開発時

開発は、「Project」に登録した「タスク」ごとに以下の手順で行なってください。

なお、「リモート」と明記していないブランチは、ローカルリポジトリのブランチを指します。

1. 「Project」で作業する「タスク」を「作業中」に変更
2. `develop` ブランチに移動
3. リモートの `develop` ブランチを `pull` し、最新状態にする
4. `develop` ブランチから `タスク名` （半角英数字）ブランチを作成
5. `タスク名` ブランチでコーディング作業
6. 作業完了後、リンターによるエラーがないかを確認しコミット
7. リモートの `タスク名` ブランチに `push`
8. リモートの `develop` ブランチにプルリクエスト（レビュワーはリーダーを選択）
9. コーディングリーダーが、プルリクエストの内容をレビュー

   - 問題なし: `develop` ブランチにマージ（リモートの `タスク名` ブランチは削除）
   - 問題あり: コーディング担当者は、5 に戻って修正対応

   ::: info プルリクを取り込んでいいか迷ったら
   コーディングリーダーで判断できない内容や、フィードバックが必要な場合は、[@hilosiva](https://github.com/hilosiva) にレビューを依頼してください。
   :::

10. 作業が完了した `タスク名` ブランチを削除
11. 他のタスクがある場合は、1 に戻る

::: info 教材
詳細は「バージョン管理の定番ツール！Git / GitHub 講座」を参照
:::

### 動作確認

テストアップできる段階になったら、コーディングリーダーが以下の作業を行なってください。

1. `develop` ブランチから、`preview` ブランチを作成（存在している場合はマージ）
2. リモートの `preview` ブランチに `push`

`preview` ブランチの内容がテスト環境に反映されます。

チームメンバーや、他のサロンメンバーに協力を依頼し動作確認を行ってください。

::: info 問題が見つかった場合
問題や修正箇所がある場合は、リモートリポジトリの「Issues」に、問題を報告してもらいましょう。
「タスク」に追加し、作業担当者などを設定後、担当者は [開発時](#開発時) の 手順で対応してください。
:::

### リリース

動作確認を行い全ての問題を解決したら、コーディングリーダーがリモートの `preview` ブランチを リモートの `main` ブランチにプルリクエストしてください。

レビュワーは、[@hilosiva](https://github.com/hilosiva) を指定してください。

プルリクエストの内容を確認し、コードレビューを行った後マージします。

::: info 問題が見つかった場合
問題を確認した場合は、リモートリポジトリの「Issues」に問題を報告します。

「タスク」に追加し作業担当者などを設定後、担当者は [開発時](#開発時) の 手順で対応してください。
:::

マージが完了すると、本番環境に反映されます。

みんなで集まって公開の喜びを分かち合いましょう！

### リリース後のバグ対応

リリース後にバグが見つかった場合は、バグの内容を「タスク」に追加し、 [開発時](#開発時) の 手順で対応してください。

::: info develop ブランチがない場合
もし、`develop` ブランチが削除されてしまっている場合は、`main` ブランチより `develop` ブランチを作成してください。
:::

## コミットメッセージ

各コミットには、コミットメッセージをつけてください。簡易的な 1 行コメントでも構いません。
なお、コミットメッセージの先頭には以下の識別子を付けてください。

| 識別子    | 役割                 |
| --------- | -------------------- |
| `add:`    | ファイルや機能の追加 |
| `update:` | ファイルや機能の修正 |
| `remove:` | ファイルや機能の削除 |

## プルリクエスト

テンプレートがある場合は、テンプレートに沿ってプルリクエストを作成してください。

テンプレートがない場合は、作業箇所をわかりやすく記載し、レビュワーが確認しやすいよう内容にしてください。
なお、説明文の中に以下の形式でタスク（イシュー）の ID 番号を含めてください。

```md
fix #番号
```
